/*!
 * Custom DataBase Tables v2.0.0 (http://ka2.org)
 * Table Creator v2.0.0
 * Copyright 2014-2015 ka2@ka2.org
 * Licensed under GPLv2 (http://www.gnu.org/licenses/gpl.txt)
 */
"undefined"!=typeof doTableCreator&&(doTableCreator=null),doTableCreator=function(){function t(t){var e,a=!1;for(var n in cdbt_admin_vars.column_types)if(t===n||_.contains(cdbt_admin_vars.column_types[n].alias,t)){a=!0,e=n;break}return a?e:a}function e(){var t=0;$("#sortable").children("tr").each(function(){$(this).hasClass("preset")||(t++,$(this).children("td.handler").html("<strong>"+t+"<strong>"))})}function a(t){var a=$("tr.preset").clone(),n=$("#sortable").children("tr").length;a.removeClass("preset").addClass("addnew").attr("data-id",n),a.children("td").each(function(){$(this).hasClass("handler")?$(this).html("<strong>"+n+"</strong>"):$(this).find("input").each(function(){var t=$(this).attr("name");$(this).removeAttr("id").attr("name",t+n)}),$(this).hasClass("auto_increment")&&($(this).find(".checkbox-custom").removeClass("checked"),$(this).find("input").prop("checked",!1)),$(this).hasClass("controll")&&$(this).children("div").removeClass("cdbt_tc_preset_controll").addClass("cdbt_tc_controll").attr("data-id",n)}),"after"===t?a.insertAfter("tr.preset"):a.insertBefore("tr.preset"),e()}function n(t,e){var a,n,i=cdbt_admin_vars.column_types[t],r="preset"===e?$("tr.preset>td.length"):$("tr[data-id="+e+"]>td.length"),o="";_.isArray(i.arg_type)?($(".length").show(),"scale"===i.arg_type[1]?(o="cdbt_tc_precision_scale",a=r.children("."+o).find("input[name^=precision_scale_m_]"),n=""!==a.val()?a.val():i["default"][0],a.attr("min",i.min[0]).attr("max",i.max[0]).val(n),a=r.children("."+o).find("input[name^=precision_scale_d_]"),n=""!==a.val()?a.val():i["default"][1],a.attr("min",i.min[1]).attr("max",i.max[1]).val(n)):(o="cdbt_tc_precision",a=r.children("."+o).find("input[name^=precision_]"),n=""!==a.val()?a.val():i["default"],a.attr("min",i.min).attr("max",i.max).attr("pattern","^["+i.arg_type.join("|")+"]$").val(n)),r.parent("tr").attr("data-sizing-cell","on")):_.contains(["precision","maxlength","array"],i.arg_type)?($(".length").show(),"precision"===i.arg_type&&(o="cdbt_tc_"+i.arg_type,a=r.children("."+o).find("input[name^=precision_]"),n=""!==a.val()?a.val():i["default"],a.attr("min",i.min).attr("max",i.max).val(n)),"maxlength"===i.arg_type&&(o="cdbt_tc_"+i.arg_type.replace("max",""),a=r.children("."+o).find("input[name^=length_]"),n=""!==a.val()?a.val():i["default"],a.attr("min",i.min).attr("max",i.max).val(n)),"array"===i.arg_type&&(o="cdbt_tc_define_values"),r.parent("tr").attr("data-sizing-cell","on")):(r.parent("tr").removeAttr("data-sizing-cell"),0===$("[data-sizing-cell=on]").size()&&$(".length").hide()),r.children("div").each(function(){""!==o&&$(this).hasClass(o)?$(this).css({display:"table"}):$(this).css({display:"none"})})}function i(t,e){var a="preset"===e?$("tr.preset>td.default"):$("tr[data-id="+e+"]>td.default");_.contains(["tinytext","text","mediumtext","longtext","tinyblob","blob","mediumblob","longblob","set"],t)?(a.find(".cdbt_tc_default").css({display:"none"}),a.parent("tr").removeAttr("data-default-cell"),0===$("[data-default-cell=on]").size()&&$(".default").hide()):($(".default").show(),a.find(".cdbt_tc_default").css({display:"table"}),a.parent("tr").attr("data-default-cell","on"))}function r(t,e){var a=cdbt_admin_vars.column_types[t],n="preset"===e?$("tr.preset>td.attributes"):$("tr[data-id="+e+"]>td.attributes");a.atts.length>0?($(".attributes").show(),n.find("input").val(n.find("input").val()||""),n.find("li").each(function(){_.contains(a.atts,$(this).data("value"))?$(this).css({display:"block"}):$(this).css({display:"none"})}),n.children(".cdbt_tc_attributes").css({display:"table"}),n.parent("tr").attr("data-attributes-cell","on")):(n.children(".cdbt_tc_attributes").css({display:"none"}),n.parent("tr").removeAttr("data-attributes-cell"),0===$("[data-attributes-cell=on]").size()&&$(".attributes").hide())}function o(t,e){var a="preset"===e?$("tr.preset>td.auto_increment"):$("tr[data-id="+e+"]>td.auto_increment");-1!==t.indexOf("int")?($(".auto_increment").show(),a.children(".cdbt_tc_auto_increment").css({display:"table"}),a.parent("tr").attr("data-autoincr-cell","on")):(a.children(".cdbt_tc_auto_increment").css({display:"none"}),a.parent("tr").removeAttr("data-autoincr-cell"),0===$("[data-autoincr-cell=on]").size()&&$(".auto_increment").hide())}function l(t,e){var a="preset"===e?$("tr.preset>td.extra"):$("tr[data-id="+e+"]>td.extra");"timestamp"===t?($(".extra").show(),a.find(".cdbt_tc_extra").css({display:"block"}),a.parent("tr").attr("data-extra-cell","on")):(a.find(".cdbt_tc_extra").css({display:"none"}),a.parent("tr").removeAttr("data-extra-cell"),0===$("[data-extra-cell=on]").size()&&$(".extra").hide())}function s(t){$("#sortable").children("tr.addnew").each(function(){$(this).data("id")===t?$(this).children("td.default").find("input").prop("disabled",!0).val(""):($(this).children("td.default").find("input").prop("disabled",!1),$(this).children("td.auto_increment").find(".checkbox-custom").checkbox("uncheck"))})}function c(e){var a=[];return _.each(e,function(e){var n="",i=cdbt_admin_vars.column_types[t(e.type_format)];if("maxlength"===i.arg_type)n=""!==e.length?e.length:i["default"];else if("precision"===i.arg_type)n=""!==e.precision?e.precision:i["default"];else if("array"===i.arg_type){var r=""!==e.define_values_cache?e.define_values_cache.split(","):[];n="'"+r.join("','")+"'"}else if(_.isArray(i.arg_type))if("scale"===i.arg_type[1]){var o="";if(_.isArray(i["default"])&&i["default"].length>0&&(o=i["default"][0]),n=""!==e.precision_scale_m?e.precision_scale_m:o,""!==n){var l="";_.isArray(i["default"])&&i["default"].length>1&&(l=i["default"][1]),""!==e.precision_scale_d?n+=","+e.precision_scale_d:""!==l&&(n+=","+l)}}else""!==e.precision&&_.contains(i.arg_type,Number(e.precision))&&(n=e.precision);if(e.sizing=""!==n?"("+n+")":"",e.attributes=""!==e.attributes?" "+e.attributes.toUpperCase():"",e.not_null=e.not_null?" NOT NULL":"",""!==e["default"]){var s=" DEFAULT ";if("timestamp"===e.type_format&&"CURRENT_TIMESTAMP"===e["default"].toUpperCase())e["default"]=s+e["default"].toUpperCase();else if(_.contains(["tinyint","smallint","mediumint","int","bigint"],e.type_format))e["default"]="NULL"===e["default"].toUpperCase()?s+"NULL":s+Number(e["default"]);else if("bit"===e.type_format){var c=/^(|b\')([0-1]+)(|\')$/;e["default"].match(c)?e["default"]=s+e["default"].replace(c,"b'$2'"):e["default"]=s+"NULL"}else _.contains(["timestamp","year","bool","boolean"],e.type_format)?e["default"]=s+Number(e["default"]):e["default"]="NULL"===e["default"].toUpperCase()?s+"NULL":s+"'"+e["default"]+"'"}e.auto_increment=e.auto_increment?" AUTO_INCREMENT":"",e.extra=""!==e.extra?" "+e.extra.toUpperCase():"",e.comment=""!==e.comment?" COMMENT '"+e.comment+"'":"",a.push("`"+e.col_name+"` "+e.type_format+e.sizing+e.attributes+e.not_null+e["default"]+e.auto_increment+e.extra+e.comment+", ")}),a.join("\n")}function d(e){var c,d,p,u=$("tr.preset"),h=e.length,f={col_name:"",type_format:"",precision:"",precision_scale_d:"",precision_scale_m:"",length:"",define_values_cache:"",not_null:!1,"default":"",attributes:"",auto_increment:!1,key_index:"",extra:"",comment:""};e.push(f),_.each(e,function(t){_.each(t,function(e,a){_.contains(["not_null","auto_increment"],a)?(c=u.find(".cdbt_tc_"+a+" .checkbox-custom"),e?(c.checkbox("check"),"auto_increment"===a&&(p=t.col_name)):c.checkbox("uncheck")):d=u.find("input[name^="+a+"]").val(e)}),h>0&&(a("before"),h--)}),$("tr.addnew").each(function(){var e=$(this).data("id"),a=$(this).find("input[name^=type_format_]").val(),c=t(a);a.length>=3&&c&&(n(c,e),i(c,e),r(c,e),o(c,e),l(c,e)),$(this).find("input[name^=col_name]").val()===p&&($(this).find(".cdbt_tc_auto_increment .checkbox-custom").checkbox("check"),s(e))})}var p=function(t){var e=40,a=$(window).height()-($("#wpadminbar").height()+Math.max($("#cdbtTableCreator div.modal-header").height(),56)+Math.max($("#cdbtTableCreator div.modal-footer").height(),65));t?($("#adminmenuwrap").hide(),$("#cdbtTableCreator div.modal-dialog").css({position:"fixed",zIndex:9999}).animate({width:"100%"},{duration:e,easing:"swing",queue:!0}),$("#cdbtTableCreator div.modal-body").css({overflow:"auto"}).animate({height:a+"px"},{duration:e,easing:"swing",queue:!1})):$("#cdbtTableCreator div.modal-body").css("height",a+"px")},u=function(){$("#cdbtModalLabel").prepend('<i class="fa fa-table"></i> '),p(!0),$("#sortable").sortable({items:"tr:not(.ui-state-disabled)",placeholder:"ui-state-highlight"}).css({position:"relative"}),$("#sortable").disableSelection(),$(document).on("click.sortable mousedown.sortable selectstart.sortable input.sortable","#sortable input",function(t){t.target.focus()}),$("#sortable input").on("mousedown.ui-disableSelection selectstart.ui-disableSelection",function(t){t.stopImmediatePropagation()});var t=JSON.parse(localStorage.getItem("cdbt-tc-cache"));null!==t&&_.isArray(t)&&t.length>0&&d(t)};$(window).resize(function(){p(!1)}),u(),$(document).popover({selector:".open_pillbox_",html:!0,content:function(){var t=$("#cdbt_tc_preset_define_values_template").clone(),e=$(this).parent().parent().parent("tr"),a=e.hasClass("addnew")?e.data("id"):"",n=t.find("input").attr("name");return t.find("input").attr("name",n+a),t.html()},template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div><div class="popover-footer"><button type="button" name="set_values_" class="btn btn-primary btn-sm" disabled="disabled">'+cdbt_admin_vars.cdbt_tc_translate.popoverSetValues+"</button></div></div>"});var h=function(){var t=arguments.length>0?arguments[0]:"";$(".cdbt_tc_define_values").each(function(){var e=$(this).parent().parent("tr").hasClass("addnew")?$(this).parent().parent("tr").data("id"):"preset",a=$(this).find(".popover");if(a.hasClass("in"))e!==t&&$(this).children(".open_pillbox_").trigger("click");else{var n=a.attr("id");a.remove(),"undefined"!=typeof $(this).children(".open_pillbox_").attr("aria-describedby")&&$(this).children(".open_pillbox_").attr("aria-describedby")===n&&$(this).children(".open_pillbox_").removeAttr("aria-describedby")}})};$(document).on("click","body",function(t){var e="";$(".popover").size()>0&&$(".popover").each(function(){$(this).hasClass("in")&&(e=$(this).parent().parent().parent("tr").hasClass("addnew")?$(this).parent().parent().parent("tr").data("id"):"preset")}),$(".open_pillbox_").each(function(){$(this).parent().parent().parent("tr").hasClass("addnew")?$(this).parent().parent().parent("tr").data("id"):"preset";$(this).is(t.target)||0!==$(this).has(t.target).length||0!==$(".popover").has(t.target).length?h(e):h()})}),$(document).on("click",".open_pillbox_",function(t){t.stopPropagation(),t.preventDefault()}).on("shown.bs.popover",".open_pillbox_",function(t){var e=$(this).parent().parent().parent("tr").hasClass("addnew")?$(this).parent().parent().parent("tr").data("id"):"preset";h(e)}).on("hidden.bs.popover",".open_pillbox_",function(t){}).on("inserted.bs.popover",".open_pillbox_",function(t){var e,a=$(this).parent().parent().parent("tr"),n=a.hasClass("addnew")?a.data("id"):"",i=$(this).attr("aria-describedby");if($(".popover").each(function(){$(this).attr("id")===i&&(e=$(this))}),"undefined"!=typeof e&&_.isObject(e)){var r=e.find("div.popover-footer>button");r.attr("name","set_values_"+n)}var o=$("input[name=define_values_cache_"+n+"]").val(),l=o.split(",");_.isArray(l)&&l.length>0&&""!==l[0]&&0===e.find(".pillbox").pillbox("itemCount")&&(_.each(l,function(t,a){return e.find(".pillbox").pillbox("addItems",a+1,[{text:t,value:t}])}),e.find(".popover-footer button").prop("disabled",!1))});var f=function(t,e){var a=t>0?!1:!0;$("button[name=set_values_"+e+"]").prop("disabled",a)};$(document).on("clicked.fu.pillbox",".pillbox",function(t,e){var a=$(this).find("input[name^=define_values_]").attr("name").replace("define_values_",""),n=$(this).pillbox("itemCount");f(n,a)}).on("added.fu.pillbox",".pillbox",function(t,e){var a=$(this).find("input[name^=define_values_]").attr("name").replace("define_values_",""),n=$(this).pillbox("itemCount");f(n,a)}).on("removed.fu.pillbox",".pillbox",function(t,e){var a=$(this).find("input[name^=define_values_]").attr("name").replace("define_values_",""),n=$(this).pillbox("itemCount");f(n,a)}).on("edited.fu.pillbox",".pillbox",function(t,e){var a=$(this).find("input[name^=define_values_]").attr("name").replace("define_values_",""),n=$(this).pillbox("itemCount");f(n,a)}),$(document).on("click","[name^=set_values_]",function(t){var e,a,n=$(this).attr("name").replace("set_values_","");return $(".pillbox").each(function(){if($(this).find("input[name^=define_values_]").attr("name")==="define_values_"+n&&(e=$(this).pillbox("itemCount"),a=$(this).pillbox("items"),e>0)){var t=_.pluck(a,"value");return $("input[name=define_values_cache_"+n+"]").val(t.join(",")),void $(this).parent().parent().parent(".cdbt_tc_define_values").children(".open_pillbox_").trigger("click")}}),!1}),$(".cdbt_tc_preset_controll button[name=add-column]").on("click",function(){h();var t="before";a(t)}),$(document).on("click",".cdbt_tc_controll button[name=delete-column]",function(){h(),$(this).parent().parent().parent("tr.addnew").fadeOut("fast",function(){$(this).remove(),e()})}),$(document).on("sortstart","#sortable",function(t,e){h()}),$(document).on("sortout","#sortable",function(t,a){e()}),$(document).on("changed.fu.combobox",".type_format .combobox",function(e,a){var s=t(a.text);if(a.text.length<3||!s)return!1;var c=s,d=$(this).parent().parent("tr").hasClass("addnew")?$(this).parent().parent("tr").data("id"):"preset";n(c,d),i(c,d),r(c,d),o(c,d),l(c,d)}),$(document).on("checked.fu.checkbox",".auto_increment .checkbox",function(t){var e=$(this).parent().parent("tr").hasClass("addnew")?$(this).parent().parent("tr").data("id"):"preset";"preset"!==e&&s(e)}),$(document).on("unchecked.fu.checkbox",".auto_increment .checkbox",function(t){var e=$(this).parent().parent("tr").hasClass("addnew")?$(this).parent().parent("tr"):"preset";"preset"!==e&&e.children("td.default").find("input").prop("disabled",!1)}),$("#reset_sql").on("click",function(){$("#sortable").sortable("cancel"),$("#sortable>tr.addnew").remove()}),$("#apply_sql").on("click",function(){var t,e=[];$("#sortable").children("tr.addnew").each(function(){t={},$(this).find("input").each(function(){var e=$(this).attr("name").replace($(this).attr("name").substr($(this).attr("name").lastIndexOf("_")),"");t[e]=_.contains(["checkbox","radio"],$(this).attr("type"))?$(this).prop("checked"):$(this).val()}),"undefined"!=typeof t.col_name&&""!==t.col_name&&e.push(t)}),e.length>0?localStorage.setItem("cdbt-tc-cache",JSON.stringify(e)):localStorage.setItem("cdbt-tc-cache",null),$("#instance_create_table_sql").val(c(e)),$("#cdbtTableCreator").modal("hide").on("hidden.bs.modal",function(t){$("#create-sql-support").trigger("click")})})};
//# sourceMappingURL=cdbt-table-creator.js.map
